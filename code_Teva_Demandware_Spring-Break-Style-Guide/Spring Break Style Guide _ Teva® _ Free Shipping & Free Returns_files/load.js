 var eiv = '2.0.0'; var exitintelAccount = 267;exitintelBetaStats = false;window.exitintelConfig = { clientId: exitintelAccount, skipPreloading: false };window.exitintelConfig.prefetchedConfiguration = {"configurations":[],"campaigns":[],"whitelabel":false,"primaryBrandColor":""};/*! ei-snippet 19-10-2015 */
!function(a,b){"use strict";Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=0>c?Math.ceil(c):Math.floor(c),0>c&&(c+=b),c=c;b>c;c++)if(c in this&&this[c]===a)return c;return-1});var c={};c.VERSION="0.0.34i",a.exitintelConfig=a.exitintelConfig||{},c.config={apiURL:"//app.exitintel.com/api/v1",cdnURL:"//cdn.exitintel.com/api/v1",profilerLibURL:"http://52.6.28.228:3333/socket.io/socket.io.js",profilerURL:"http://52.6.28.228:3333/",compatibleJQueryVersions:"2.1.4 2.1.3 2.1.1 2.1.0 2.0.3 2.0.2 2.0.1 2.0.0 1.11.2 1.11.1 1.11.0 1.10.2 1.10.1 1.10.0 1.9.1 1.9.0 1.8.3 1.8.2 1.8.1 1.8.0 1.7.2 1.7.1 1.7.0".split(" "),cookieExpirationDays:240,debug:!1,clientId:null,whitelabel:!0,primaryBrandColor:"#333",schemaVersion:1,profilerEnabled:a.exitintelConfig.profilerEnabled||!1,skipPreloading:a.exitintelConfig.skipPreloading||!1,prefetchedConfiguration:a.exitintelConfig.prefetchedConfiguration||!1},c.util={jQuery:null,detectDevice:{},loadJQuery:function(a){return window.jQei&&window.jQei.fn&&-1!==c.config.compatibleJQueryVersions.indexOf(window.jQei.fn.jquery)?(c.util.jQuery=window.jQei,a(c.util.jQuery),void c.util.log("Using legacy snippet jQuery.")):"undefined"==typeof window.jQuery||-1==c.config.compatibleJQueryVersions.indexOf(window.jQuery.fn.jquery)?(c.util.log("Loading jQuery"),void c.util.loadJS("//ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js",function(){c.util.log("jQuery loaded ("+jQuery.fn.jquery+")");var b=jQuery.noConflict(!0);c.util.jQuery=b,a(c.util.jQuery)})):(c.util.jQuery=window.jQuery,a(c.util.jQuery),void c.util.log("jQuery already loaded"))},loadJS:function(a,b){var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript",d.src=a,"undefined"!=typeof d.onreadystatechange?d.onreadystatechange=function(){("complete"==d.readyState||"loaded"==d.readyState)&&setTimeout(b,100)}:d.onload=b,c.appendChild(d)},onDOMReady:function(a){if(document.readyState&&-1!==["complete"].indexOf(document.readyState)&&a(),document.addEventListener)document.addEventListener("DOMContentLoaded",a,!1);else if(document.attachEvent)document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&a()});else{var b=window.onload;window.onload=function(){b&&b(),a()}}},loadCSS:function(){},getUniqueId:function(){var a=(new Date).getTime(),b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},log:function(a){c.config.debug&&console.log(a)},warn:function(a){c.config.debug&&console.warn(a)},pageURLIs:function(a){for(var b=a.toLowerCase().split(","),c=0;c<b.length;c++){var d=b[c];if(document.URL.toLowerCase()==d)return!0}return!1},pageURLContains:function(a){for(var b=a.toLowerCase().split(","),c=0;c<b.length;c++){var d=b[c];if(document.URL.toLowerCase().indexOf(d)>-1)return!0}return!1},referrerURLIs:function(a){for(var b=a.toLowerCase().split(","),d=0;d<b.length;d++){var e=b[d];if(c.visitor.session.originalReferrer.toLowerCase()==e)return!0}return!1},referrerURLContains:function(a){for(var b=a.toLowerCase().split(","),d=0;d<b.length;d++){var e=b[d];if(c.visitor.session.originalReferrer.toLowerCase().indexOf(e)>-1)return!0}return!1},landingPageURLIs:function(a){for(var b=a.toLowerCase().split(","),d=0;d<b.length;d++){var e=b[d];if(c.visitor.session.landingPage.toLowerCase()==e)return!0}return!1},landingPageURLContains:function(a){for(var b=a.toLowerCase().split(","),d=0;d<b.length;d++){var e=b[d];if(c.visitor.session.landingPage.toLowerCase().indexOf(e)>-1)return!0}return!1},preloadImage:function(a){var b=new c.util.jQuery.Deferred,d=new Image;return d.onload=function(){b.resolve()},d.src=a,b},getDayOffset:function(a){if(!a)return null;var b=Math.floor((new Date).getTime()/1e3),c=b+3600*a*24;return c},ieVersion:function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="<!--[if gt IE "+ ++b+"]><i></i><![endif]-->",d[0];);return b>4?b:a},isPlaceholderSupported:function(){var a="[object OperaMini]"==Object.prototype.toString.call(window.operamini),b="placeholder"in document.createElement("input")&&!a;return b},campaignCookieWithinTimeOffset:function(a,b,c){var d=Math.floor((new Date).getTime()/1e3);return b&&a.timestamp&&a.timestamp+24*b*3600>d?!1:c&&a.timestamp&&a.timestamp+24*c*3600<d?!1:!0}},function(a){var b=/iPhone/i,c=/iPod/i,d=/iPad/i,e=/(?=.*\bAndroid\b)(?=.*\bMobile\b)/i,f=/Android/i,g=/IEMobile/i,h=/(?=.*\bWindows\b)(?=.*\bARM\b)/i,i=/BlackBerry/i,j=/BB10/i,k=/Opera Mini/i,l=/(?=.*\bFirefox\b)(?=.*\bMobile\b)/i,m=new RegExp("(?:Nexus 7|BNTV250|Kindle Fire|Silk|GT-P1000)","i"),n=function(a,b){return a.test(b)},o=function(a){var o=a||navigator.userAgent;return this.apple={phone:n(b,o),ipod:n(c,o),tablet:n(d,o),device:n(b,o)||n(c,o)||n(d,o)},this.android={phone:n(e,o),tablet:!n(e,o)&&n(f,o),device:n(e,o)||n(f,o)},this.windows={phone:n(g,o),tablet:n(h,o),device:n(g,o)||n(h,o)},this.other={blackberry:n(i,o),blackberry10:n(j,o),opera:n(k,o),firefox:n(l,o),device:n(i,o)||n(j,o)||n(k,o)||n(l,o)},this.seven_inch=n(m,o),this.any=this.apple.device||this.android.device||this.windows.device||this.other.device||this.seven_inch,this.phone=this.apple.phone||this.android.phone||this.windows.phone,this.tablet=this.apple.tablet||this.android.tablet||this.windows.tablet,"undefined"==typeof window?this:void 0},p=function(){var a=new o;return a.Class=o,a};"undefined"!=typeof module&&module.exports&&"undefined"==typeof window?module.exports=o:"undefined"!=typeof module&&module.exports&&"undefined"!=typeof window?module.exports=p():"function"==typeof define&&define.amd?define("isMobile",[],a.isMobile=p()):a.isMobile=p()}(c.util.detectDevice),c.util.loadJQuery(function(d){window.XDomainRequest&&d.ajaxTransport(function(a){if(a.crossDomain&&a.async){a.timeout&&(a.xdrTimeout=a.timeout,delete a.timeout);var c;return{send:function(e,f){function g(a,e,g,h){c.onload=c.onerror=c.ontimeout=d.noop,c=b,f(a,e,g,h)}c=new XDomainRequest,c.onload=function(){g(200,"OK",{text:c.responseText},"Content-Type: "+c.contentType)},c.onerror=function(){g(404,"Not Found")},c.onprogress=d.noop,c.ontimeout=function(){g(0,"timeout")},c.timeout=a.xdrTimeout||Number.MAX_VALUE,c.open(a.type,a.url),c.send(a.hasContent&&a.data||null)},abort:function(){c&&(c.onerror=d.noop,c.abort())}}}}),c.api={getCampaigns:function(a){var b="";191===a&&(b="?_t="+Math.floor((new Date).valueOf()/3e5)),setTimeout(function(){d.ajax({url:c.config.cdnURL+"/serve/"+a+b,jsonp:"callback",jsonpCallback:"exitintel.campaign.campaignsFileLoaded",dataType:"jsonp",cache:!0})})}},c.ad={installedAds:{},adTriggers:{},visibleAds:{popup:null,persistent:null},install:function(a,b){var d=new c.util.jQuery.Deferred;return c.util.log("Installing "+a.id),"undefined"!=typeof this.installedAds[a.id]?(c.util.log(a.id+" is already installed"),d.resolve(this.installedAds[a.id]),d):(c.profiler.send("ad-installing:"+a.id),this.preloadImages(a,function(){c.profiler.send("ad-preloaded:"+a.id),c.util.log("Images loaded for "+a.id);var e=c.ad.render(a);e&&(c.ad.installedAds[a.id]=e,a.pageImpressions=0,b&&b.noTriggers||(c.util.log("Installing trigger for "+a.id),c.ad.installTrigger(a,e,{displayLimitPerPage:b.displayLimitPerPage,priority:b.priority})),d.resolve(e))}),d)},preloadImages:function(a,b){var e=[],f=[];if(c.config.skipPreloading)return void b();for(var g=0;g<a.selectedVersion.template.panels.length;g++){var h=a.selectedVersion.template.panels[g];h.backgroundImage&&e.push(c.config.cdnURL+h.backgroundImage)}for(var i=0;i<e.length;i++)f.push(c.util.preloadImage(e[i]));return f.length?void d.when.apply(d,f).then(function(){b()},function(){c.util.log("Images failed to load. Aborting.")}):void b()},installTrigger:function(a,b,d){var e=c.util.detectDevice.isMobile,f="desktop";e.phone?f="phone":e.tablet&&(f="tablet");var g=a.selectedVersion.trigger?a.selectedVersion.trigger[f]:null;c.util.log("Installing trigger for "+f);var h=null,i={"on-load":"onLoad","on-stop-scrolling":"onScrollTimeout","on-scrolled-to-bottom":"onScrolledToBottom","on-scrolled-to-element":"onScrolledToElement","on-exit-intent":"onExit",manual:null};if(g&&g.type&&i[g.type]){if("undefined"==typeof c.ad.adTriggers[g.type]&&(c.ad.adTriggers[g.type]={}),c.ad.adTriggers[g.type].triggerId){if(!(d.priority>c.ad.adTriggers[g.type].priority))return;c.trigger.uninstall(c.ad.adTriggers[g.type].triggerId)}h=c.trigger.install(i[g.type],this.showAdFunction(a,b,d),{delay:g.delay||0,selector:g.selector||null,targetMode:g.targetMode||null,postpone:g.postpone||null,postponeBy:g.postponeBy||0}),c.profiler.send("ad-trigger-installed:"+a.id),c.util.log("Installed trigger: "+g.type+" for "+a.id),a.triggerId=h,c.ad.adTriggers[g.type]={priority:d.priority,triggerId:h}}},showAdFunction:function(a,b,d){return function(){if("Popup"==a.selectedVersion.template.type&&null!==c.ad.visibleAds.popup)return void c.util.log("Ad of type "+a.selectedVersion.template.type+" already displayed.");if("Persistent"==a.selectedVersion.template.type&&null!==c.ad.visibleAds.persistent)return void c.util.log("Ad of type "+a.selectedVersion.template.type+" already displayed.");if(d.displayLimitPerPage&&d.displayLimitPerPage<=a.pageImpressions)return void c.util.log("Ad "+a.id+" not shown because it reached page impression limit.");if(b.show(),a.pageImpressions++,c.event.log("ad-impression",{campaignId:a.campaignId,adId:a.id}),c.profiler.send("ad-impression:"+a.id),c.visitor.setSeenCampaign(a.campaignId,{adId:a.id}),a.selectedVersion.template.impressionJS){var e=new Function(a.selectedVersion.template.impressionJS);e()}}},render:function(a){return"Popup"==a.selectedVersion.template.type?this.renderPopup(a):"Persistent"==a.selectedVersion.template.type?this.renderPersistent(a):void c.util.log("Cannot render ad of type: "+a.selectedVersion.template.type)},renderPopup:function(a){var b=new c.renderers.popup(a.campaignId,a.id,a.selectedVersion.template);return b},renderPersistent:function(a){var b=new c.renderers.persistent(a.campaignId,a.id,a.selectedVersion.template);return b},getVersionDependencies:function(a){var b=[];if(!a.template||!a.template.panels)return[];for(var c=0;c<a.template.panels.length;c++)for(var d=a.template.panels[c],e=0;e<d.elements.length;e++){var f=d.elements[e];if(f.actions&&f.actions.length)for(var g=0;g<f.actions.length;g++){var h=f.actions[g];"trigger-ad"===h["class"]&&h.params.adId&&b.push(h.params)}}return b},enableCustomCSS:function(a,b){if(b.customCSS){var c=d("<style>"+b.customCSS+"</style>").attr("id","ei-style-"+a).attr("type","text/css");d("body").append(c)}},disableCustomCSS:function(a){d("#ei-style-"+a).remove()}},c.elementActions={runAction:function(a,b){var d=c.util.jQuery.data(a[0],"ei-actions");c.util.jQuery.data(a[0],"ei-action-status","pending"),c.plugins.activityIndicator.show(),d[b]?d[b]().then(function(){d[b+1]?c.elementActions.runAction(a,b+1):(c.plugins.activityIndicator.hide(),c.util.jQuery.data(a[0],"ei-action-status","done"))},function(){c.util.log("action "+b+" failed. Stopping"),c.plugins.activityIndicator.hide(),c.util.jQuery.data(a[0],"ei-action-status","failed")}):(c.util.log("action queue done"),c.plugins.activityIndicator.hide(),c.util.jQuery.data(a[0],"ei-action-status","done"))},install:function(a,b){var e=null;switch(b["class"]){case"goto-step":e=c.elementActionTypes.gotoStep.install(a,b);break;case"close-ad":e=c.elementActionTypes.closeAd.install(a);break;case"goto-url":e=c.elementActionTypes.gotoUrl.install(a,b);break;case"submit-form":e=c.elementActionTypes.submitForm.install(a,b);break;case"trigger-ad":e=c.elementActionTypes.triggerAd.install(a,b);break;case"collect-data":e=c.elementActionTypes.collectData.install(a,b);break;case"send-to-mailchimp":e=c.elementActionTypes.integrationMailchimp.install(a,b);break;case"custom-code":e=c.elementActionTypes.customCode.install(a,b);break;case"reload-ads":e=c.elementActionTypes.reloadAds.install(a,b);break;default:c.util.log("Action class '"+b["class"]+"' is not supported")}var f=c.util.jQuery.data(a[0],"ei-actions");f||(f=[],c.util.jQuery(a).on("click",function(){c.elementActions.runAction(d(this),0)})),e&&f.push(e),c.util.jQuery.data(a[0],"ei-actions",f)}},c.elementActionTypes={gotoStep:{install:function(a,b){var e=c.util.jQuery.data(a,"adObject");return function(){var f=new c.util.jQuery.Deferred;if(b.params.validateStep)for(var g=a.parents(".exitintel-panel"),h=g.find("input[data-exitintel-name],select[data-exitintel-name]"),i=0;i<h.length;i++){var j=h[i],k=d.data(j,"validators"),l=d(j).val();if(k)for(var m=0;m<k.length;m++)if(!k[m](l))return f.reject(),f.promise()}return e.showPanel(b.params.stepNumber),f.resolve(),f.promise()}}},closeAd:{install:function(a){var b=c.util.jQuery.data(a,"adObject");return function(){var a=new c.util.jQuery.Deferred;return b.hide(),c.visitor.setDisabledCampaign(b.campaignId),a.resolve(),a.promise()}}},gotoUrl:{install:function(a,b){return b.params.newWindow&&a.on("click",function(){var a=window.open(b.params.url,"_blank");a.focus()}),function(){var a=new c.util.jQuery.Deferred;return b.params.newWindow?(a.resolve(),a.promise()):void(window.location.href=b.params.url)}}},submitForm:{install:function(a,b){"new-window"==b.params.submitMethod&&a.on("click",function(a){e().then(function(a){a&&a.submit()}),a.preventDefault()});var e=function(){var e=new c.util.jQuery.Deferred,f=c.util.jQuery.data(a,"adObject"),g=d("<form></form>").attr("action",b.params.url).attr("method","POST");switch(b.params.submitMethod){case"current-window":break;case"new-window":g.attr("target","blank");break;case"ajax":g.on("submit",function(a){a.preventDefault(),c.util.jQuery.post(b.params.url,d(this).serialize(),function(){e.resolve()}).fail(function(){alert("An error occured. Please check your data and try again later."),e.reject()})})}for(var h in b.params.includedData)if("function"!=typeof b.params.includedData[h]){var i=f.popupElement?f.popupElement:f.persistentElement,j=i.find('[data-exitintel-name="'+h+'"]'),k=j.val(),l=b.params.includedDataVarName[h],m=d.data(j[0],"validators");if(m)for(var n=0;n<m.length;n++)if(!m[n](k))return e.reject(),e.promise();var o=d("<input/>").attr("name",l).val(k);g.append(o)}if(b.params.additionalVars)for(var p in b.params.additionalVars){var q=b.params.additionalVars[p],r=d("<input/>").attr("name",q.name).val(q.value);g.append(r)}return c.util.jQuery("body").append(g),g.submit(),"ajax"!==b.params.submitMethod&&e.resolve(g),e.promise()};return"new-window"==b.params.submitMethod?function(){var a=new c.util.jQuery.Deferred;return a.resolve(),a.promise()}:e}},triggerAd:{install:function(a,b){return function(){for(var a=new c.util.jQuery.Deferred,d=0;d<c.campaign.available.length;d++){var e=c.campaign.available[d];if(e.id==b.params.campaignId){var f=null;if(b.params.adId){for(var g=0;g<e.enabled_ads.length;g++)if(e.enabled_ads[g].id==b.params.adId){f=e.enabled_ads[g];break}c.util.log("Could not find ad "+b.params.adId+" in enabled ads.")}else if(e.selectedAd)f=e.selectedAd;else{var h=Math.floor(Math.random()*e.enabled_ads.length);f=e.enabled_ads[h]}c.ad.install(f,{noTriggers:!0}).then(function(b){c.ad.showAdFunction(f,b,{})(),a.resolve()},function(){a.reject()})}}return a.promise()}}},collectData:{install:function(a,b){return function(){var e=new c.util.jQuery.Deferred,f=[],g=c.util.jQuery.data(a,"adObject");if(b.params&&b.params.includedData)for(var h in b.params.includedData)if("function"!=typeof b.params.includedData[h]){var i=g.popupElement?g.popupElement:g.persistentElement,j=i.find('[data-exitintel-name="'+h+'"]'),k=j.val(),l=b.params.includedDataVarName[h],m=d.data(j[0],"validators");if(m)for(var n=0;n<m.length;n++)if(!m[n](k))return e.reject(),e.promise();f.push({name:l,value:k,order:b.params.includedDataOrder&&b.params.includedDataOrder[h]?b.params.includedDataOrder[h]:0})}f.sort(function(a,b){return a.order<b.order?-1:a.order>b.order?1:0});for(var o={},p=0;p<f.length;p++)o[f[p].name]=f[p].value;var q=c.campaign.get(g.campaignId),r=q.selectedAd;return c.visitor.setConvertedCampaign(g.campaignId,{adId:g.id}),c.event.log("collect-data",{campaignId:g.campaignId,adId:r.id,data:o,onDone:function(a){a?e.resolve():(alert("Your data was not sent. Please try again in a few moments."),e.reject())}}),e.promise()}}},customCode:{install:function(a,b){-1==b.params.code.indexOf("deferred.resolve()")&&(b.params.code+=";deferred.resolve();"),-1==b.params.code.indexOf("return deferred.promise();")&&(b.params.code+=";return deferred.promise();");var d=new Function("deferred","element","action",b.params.code);return function(){var e=new c.util.jQuery.Deferred;return d(e,a,b)}}},integrationMailchimp:{install:function(a,b){return function(){var e=c.util.jQuery.data(a,"adObject");b.params||(b.params={});var f=new c.util.jQuery.Deferred,g={};if(b.params&&b.params.includedData)for(var h in b.params.includedData)if("function"!=typeof b.params.includedData[h]){var i=e.popupElement?e.popupElement:e.persistentElement,j=i.find('[data-exitintel-name="'+h+'"]'),k=j.val(),l=b.params.includedDataVarName[h],m=d.data(j[0],"validators");if(m)for(var n=0;n<m.length;n++)if(!m[n](k))return f.reject(),f.promise();g[l]=k}return c.visitor.session.ip&&(g.optin_ip=c.visitor.session.ip),d.ajax({url:c.config.apiURL+"/integration/mailchimp/addToList/"+e.adId,jsonp:"callback",dataType:"jsonp",data:g,timeout:1e4,success:function(a){return"success"!=a.status?(alert("We where unable to process your information. Please check your email address and try again in a few moments."),void f.reject()):void f.resolve()},error:function(){alert("We where unable to process your information. Please check your email address and try again in a few moments."),f.reject()}}),f.promise()}}},reloadAds:{install:function(){return function(){for(var a=new c.util.jQuery.Deferred,b=0;b<c.campaign.available.length;b++)c.campaign.available[b].selectedAd=null;for(var d in c.ad.visibleAds){var e=c.ad.visibleAds[d];"function"!=typeof e&&e&&e.hide()}return c.ad.installedAds={},c.campaign.active=[],c.trigger.uninstallAll(),c.ad.adTriggers={},c.campaign.campaignsLoaded(),a.resolve(),a}}}},c.renderers=c.renderers||{},c.renderers.popup=function(a,b,e){if(c.util.log("Creating popup"),this.campaignId=a,this.adId=b,this.currentPanel=null,this.showCallbacks=[],this.template=e,this.overlayElement=d("<div></div>").addClass("exitintel-overlay").attr("id","exitintel_ovelay_"+this.adId).css({position:"fixed",top:0,left:0,background:e.overlayBackgroundColor||"rgba(0, 0, 0, 0.8)",width:"100%",height:"100%","z-index":"81000003",display:"none"}),e.overlayBackgroundColor&&"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9&&(e.overlayBackgroundColor.match(/rgba\(.*,[^d]*0\)/)?this.overlayElement.css("background","transparent"):this.overlayElement.css("background",e.overlayBackgroundColor.replace(/^rgba\((\d+)[^\d]+(\d+)[^\d]+(\d+).*/,"rgb($1, $2, $3)"))),this.popupElement=d("<div></div>").addClass("exitintel-popup").attr("id","exitintel_popup_"+this.adId).css({position:"absolute",width:e.width,height:e.height,left:"50%","margin-left":-1*parseInt(e.width,10)/2+"px",top:"50%","margin-top":-1*parseInt(e.height,10)/2+"px",display:"none"}),e.backgroundColor&&(this.popupElement.css({"background-color":e.backgroundColor}),"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9&&(e.backgroundColor.match(/rgba\(.*,[^\d]+0\)/)?this.popupElement.css("background","transparent"):this.popupElement.css("background",e.backgroundColor.replace(/^rgba\((\d+)[^\d]+(\d+)[^\d]+(\d+).*/,"rgb($1, $2, $3)")))),!c.config.whitelabel){var f=d("<a></a>").attr("href","http://www.exitintel.com").attr("target","_blank").html("Powered by <strong>Exit Intel</strong>").css({color:"white","font-family":"Arial, Helvetica, sans-serif","font-size":"16px",position:"absolute",left:"20px",bottom:"20px","text-decoration":"none"});this.overlayElement.append(f)}c.util.log("Rendering panels");for(var g=0;g<e.panels.length;g++)this.renderPanel(g,e.panels[g]);this.overlayElement.append(this.popupElement),d("body").append(this.overlayElement);var h=this,i=e;c.util.log("Installing default handler for enter"),this.popupElement.keypress(function(a){if(13==a.keyCode){var b=i.panels[h.currentPanel];if(null===b)return void c.util.log("No current panel. Cannot trigger default action");if(b.onEnter){var d=h.popupElement;d.find("#exitintel_panel_"+h.currentPanel+' [data-exitintel-name="'+b.onEnter+'"]').click()}}})},c.renderers.popup.prototype.renderPanel=function(a,b){var e=d("<div></div>").addClass("exitintel-panel").attr("id","exitintel_panel_"+a).attr("data-panel-id",a).css({position:"absolute",width:"100%",height:"100%"});if(b.backgroundImage)if("undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9){var f=d("<div></div>");f.attr("style","position:relative;width:100%;height:100%;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader( src='"+c.config.cdnURL+b.backgroundImage+"', sizingMethod='scale')"),e.append(f)}else e.css({background:"transparent url('"+c.config.cdnURL+b.backgroundImage+"') 0 0 no-repeat","background-size":"100% 100%"});b.backgroundPosition&&e.css({"background-position":""+b.backgroundPosition.horizontal+" "+b.backgroundPosition.vertical});for(var g={label:"label","input-email":"inputEmail","input-general":"inputGeneral",button:"button",countdown:"countdown"},h=0;h<b.elements.length;h++){var i=b.elements[h],j=g[i.type],k=c.renderers.element[j](i,this);k.attr("data-element-panel-id",a),i.backgroundColor&&"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9&&(i.backgroundColor=i.backgroundColor.replace(/^rgba\((\d+)[^\d]+(\d+)[^\d]+(\d+)*/,"rgb($1, $2, $3)")),k.css({"text-align":i.align,position:"absolute",width:i.size.width+"px",height:i.size.height+"px",font:i.font.weight+" "+i.font.size+"px "+i.font.family,"line-height":i.font.height+"px",color:i.color,"background-color":i.transparent?"transparent":i.backgroundColor,border:"none",padding:0,outline:"none"});for(var l=["left","top","right","bottom"],m=0;m<l.length;m++){var n=l[m];k.css(n,i.position[n]+"px")}i.backgroundImage&&(k.css({"background-image":"url("+c.config.cdnURL+i.backgroundImage+")","background-repeat":"no-repeat"}),i.backgroundPosition&&k.css({"background-position":""+i.backgroundPosition.horizontal+" "+i.backgroundPosition.vertical})),"outer"==i.container?this.overlayElement.append(k):e.append(k)}this.popupElement.append(e)},c.renderers.popup.prototype.showPanel=function(a){this.popupElement.find(".exitintel-panel").hide(),this.overlayElement.find("[data-element-panel-id][data-element-panel-id!="+a+"]").hide(),this.overlayElement.find("[data-element-panel-id="+a+"]").show(),this.popupElement.find("[data-panel-id="+a+"]").show(),this.currentPanel=a},c.renderers.popup.prototype.show=function(){if(c.util.log("Showing ad"),this.overlayElement.show(),this.popupElement.show(),this.showPanel(0),c.ad.visibleAds.popup=this,this.showCallbacks.length)for(var a=0;a<this.showCallbacks.length;a++)this.showCallbacks[a].call();c.ad.enableCustomCSS(this.adId,this.template)},c.renderers.popup.prototype.hide=function(){this.overlayElement.hide(),this.popupElement.hide(),c.ad.visibleAds.popup=null,c.ad.disableCustomCSS(this.adId)},c.renderers=c.renderers||{},c.renderers.persistent=function(a,b,e){this.campaignId=a,this.adId=b,this.panels=[],this.showCallbacks=[],this.template=e,e.backgroundColor&&"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9&&(e.backgroundColor=e.backgroundColor.match(/rgba\(.*,[^d]*0\)/)?"transparent":e.backgroundColor.replace(/^rgba\((\d+)[^\d]+(\d+)[^\d]+(\d+).*/,"rgb($1, $2, $3)")),this.persistentElement=d("<div></div>").addClass("exitintel-persistent").attr("id","exitintel_persistent_"+this.adId).css({position:"fixed",display:"none","background-color":e.backgroundColor,"text-align":"center","z-index":81e6}),this.innerCanvasElement=d("<div></div>").addClass("exitintel-inner-canvas").attr("id","exitintel_persistent_"+this.adId).css({position:"relative","background-color":"transparent","text-align":"center","z-index":81000001,margin:"auto",top:0,width:e.persistentInnerCanvasPosition.width,height:e.persistentInnerCanvasPosition.height});var f={top:"top",bottom:"bottom",left:"left",right:"right",marginLeft:"margin-left",marginTop:"margin-top",width:"width",height:"height"};for(var g in f)if("function"!=typeof f[g]){var h=e.persistentPosition[g];"undefined"!=typeof h&&this.persistentElement.css(f[g],h)}if(e.persistentPosition.rotation){if(this.persistentElement.css("pointer-events","none"),"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9)return!1;for(var i=["transform","-webkit-transform","-moz-transform","-ms-transform"],j=0;j<i.length;j++)this.persistentElement.css(i[j],"rotate("+e.persistentPosition.rotation+"deg)"),this.persistentElement.css(i[j]+"-origin","0 0")}for(var k=0;k<e.panels.length;k++)this.renderPanel(k,e.panels[k]);this.persistentElement.append(this.innerCanvasElement),d("body").append(this.persistentElement)},c.renderers.persistent.prototype.renderPanel=function(a,b){var e=d("<div></div>").addClass("exitintel-panel").attr("id","exitintel_panel_"+a).attr("data-panel-id",a).css({position:"absolute",width:"100%",height:"100%",overflow:"hidden","z-index":"81000004"});if(b.backgroundImage)if("undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9){var f=d("<div></div>");f.attr("style","position:relative;width:100%;height:100%;filter:progid:DXImageTransform.Microsoft.AlphaImageLoader( src='"+c.config.cdnURL+b.backgroundImage+"', sizingMethod='scale')"),e.append(f)}else e.css({background:"transparent url('"+c.config.cdnURL+b.backgroundImage+"') 0 0 no-repeat","background-size":"100% 100%"});b.backgroundPosition&&e.css({"background-position":""+b.backgroundPosition.horizontal+" "+b.backgroundPosition.vertical});for(var g={label:"label","input-email":"inputEmail","input-general":"inputGeneral",button:"button",countdown:"countdown"},h=0;h<b.elements.length;h++){var i=b.elements[h],j=g[i.type],k=c.renderers.element[j](i,this);k.attr("data-element-panel-id",a),k.css({"text-align":i.align,position:"absolute",width:i.size.width+"px",height:i.size.height+"px",font:i.font.weight+" "+i.font.size+"px "+i.font.family,"line-height":i.font.height+"px",color:i.color,"background-color":i.transparent?"transparent":i.backgroundColor,border:"none","z-index":"81000005",padding:0,outline:"none"});for(var l=["left","top","right","bottom"],m=0;m<l.length;m++){var n=l[m];k.css(n,i.position[n]+"px")}i.backgroundImage&&(k.css({"background-image":"url("+c.config.cdnURL+i.backgroundImage+")","background-repeat":"no-repeat"}),i.backgroundPosition&&k.css({"background-position":""+i.backgroundPosition.horizontal+" "+i.backgroundPosition.vertical})),"outer"==i.container?this.persistentElement.append(k):e.append(k)}this.innerCanvasElement.append(e)},c.renderers.persistent.prototype.showPanel=function(a){this.persistentElement.find(".exitintel-panel").hide(),this.persistentElement.find("[data-element-panel-id][data-element-panel-id!="+a+"]").hide(),this.persistentElement.find("[data-element-panel-id="+a+"]").show(),this.persistentElement.find("[data-panel-id="+a+"]").show(),this.currentPanel=a},c.renderers.persistent.prototype.show=function(){if(this.persistentElement.show(),this.showPanel(0),c.ad.visibleAds.persistent=this,this.showCallbacks.length)for(var a=0;a<this.showCallbacks.length;a++)this.showCallbacks[a].call();c.ad.enableCustomCSS(this.adId,this.template)},c.renderers.persistent.prototype.hide=function(){this.persistentElement.hide(),c.ad.visibleAds.persistent=null,c.ad.disableCustomCSS(this.adId)},c.renderers=c.renderers||{},c.renderers.element={label:function(a){var b=d("<div></div>");return b.html(a.placeholder),b.css({"pointer-events":"auto"}),b},inputEmail:function(a){var b=d("<input />");b.attr("type","email"),b.attr("data-exitintel-name",a.name),b.attr("placeholder",a.placeholder),b.css({"pointer-events":"auto"}),c.util.isPlaceholderSupported()||c.plugins.customPlaceholders(b);var e=[];return e.push(function(a){if(""===a)return!0;var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)?!0:(alert("Your email address format is wrong."),!1)}),a.required&&e.push(function(a){return""===a?(alert("Please fill in all the required fields."),!1):!0}),c.util.jQuery.data(b[0],"validators",e),b},inputGeneral:function(a){var b=d("<input />");b.attr("type","text"),b.css({"pointer-events":"auto"}),b.attr("data-exitintel-name",a.name),b.attr("placeholder",a.placeholder),c.util.isPlaceholderSupported()||c.plugins.customPlaceholders(b);var e=[];return a.required&&e.push(function(a){return""===a?(alert("Please fill in all the required fields."),!1):!0}),c.util.jQuery.data(b[0],"validators",e),b},button:function(a,b){var e=d("<button />");if(e.html(a.placeholder),e.attr("data-exitintel-name",a.name),e.css({cursor:"pointer","pointer-events":"auto"}),c.util.jQuery.data(e,"adObject",b),a.actions)for(var f=0;f<a.actions.length;f++)c.elementActions.install(e,a.actions[f]);return e},countdown:function(a,b){var e=d("<div></div>").addClass("countdown");e.css({"pointer-events":"auto"});var f=b.campaignId+":"+a.name,g=new c.plugins.countdown(f,e,a.countdown);return b.showCallbacks.push(g.start.bind(g)),e}},c.plugins=c.plugins||{},c.plugins.countdown=function(a,b,d){this.id=a,this.settins=d,this.$el=b,this.secondsOffset=0,this.startedAt=null;var e=c.cookie.getJSON("countdowns",{});e&&e[this.id]&&(this.startedAt=e[this.id].startedAt),d.hours&&(this.secondsOffset+=3600*parseInt(d.hours,10)),d.minutes&&(this.secondsOffset+=60*parseInt(d.minutes,10)),d.seconds&&(this.secondsOffset+=parseInt(d.seconds,10)),this.$el.html('<span data-ei-class="hours">00</span><span data-ei-class="hm-seperator">:</span><span data-ei-class="minutes">00</span><span data-ei-class="ms-seperator">:</span><span data-ei-class="seconds">00</span>')},c.plugins.countdown.prototype.start=function(){if(!this.startedAt){var a=Math.floor(Date.now()/1e3),b=c.cookie.getJSON("countdowns",{}),d={startedAt:a};b[this.id]=d,c.cookie.setJSON("countdowns",b),this.startedAt=a}this.tick()},c.plugins.countdown.prototype.tick=function(){var a=Math.floor(Date.now()/1e3),b=this.startedAt+this.secondsOffset,c=b-a;if(0>=c)return this.setElement("hours",0),this.setElement("minutes",0),void this.setElement("seconds",0);var d=Math.floor(c/3600),e=Math.floor(c%3600/60),f=c%60;this.setElement("hours",d),this.setElement("minutes",e),this.setElement("seconds",f),setTimeout(this.tick.bind(this),1e3)},c.plugins.countdown.prototype.setElement=function(a,b){var c=b;10>c&&(c="0"+c),this.$el.find('[data-ei-class="'+a+'"]').html(c),"hours"==a&&0===b&&(this.$el.find('[data-ei-class="hours"]').hide(),this.$el.find('[data-ei-class="hm-seperator"]').hide())},c.plugins=c.plugins||{},c.plugins.activityIndicator={installed:!1,overlayElement:null,indicatorElement:null,install:function(){this.overlayElement=d("<div></div>").addClass("exitintel-overlay").attr("id","exitintel_activity_indicator_ovelay").css({position:"fixed",top:0,left:0,background:"rgba(255, 255, 255, 0.6)",width:"100%",height:"100%","z-index":"81000006",display:"none"}),"undefined"!=typeof c.util.ieVersion()&&c.util.ieVersion()<9&&this.overlayElement.css("background","transparent"),this.indicatorElement=d("<div></div>").addClass("exitintel-activity-indicator").attr("id","exitintel_activity_indicator").css({position:"absolute",width:100,height:100,left:"50%","margin-left":-50,top:"30%","margin-top":-50}),this.indicatorElement.html('<div id="exitintel-spinner"></div>');var a=document.createElement("style");a.setAttribute("id","ei-style-spinner"),a.setAttribute("type","text/css"),a.type="text/css";var b="#exitintel-spinner:before,#exitintel-spinner:after,#exitintel-spinner {border-radius: 50%;width: 2.5em;height: 2.5em;-webkit-animation-fill-mode: both;animation-fill-mode: both;-webkit-animation: exitintel-activity-animation 1.8s infinite ease-in-out;animation: exitintel-activity-animation 1.8s infinite ease-in-out;}#exitintel-spinner {margin: 8em auto;font-size: 10px;position: relative;text-indent: -9999em;-webkit-animation-delay: 0.16s;animation-delay: 0.16s;}#exitintel-spinner:before {left: -3.5em;}#exitintel-spinner:after {left: 3.5em;-webkit-animation-delay: 0.32s;animation-delay: 0.32s;}#exitintel-spinner:before,#exitintel-spinner:after {content: '';position: absolute;top: 0;}@-webkit-keyframes exitintel-activity-animation {0%,80%,100% {box-shadow: 0 2.5em 0 -1.3em "+c.config.primaryBrandColor+";}40% {box-shadow: 0 2.5em 0 0 "+c.config.primaryBrandColor+";}}@keyframes exitintel-activity-animation {0%,80%,100% {box-shadow: 0 2.5em 0 -1.3em "+c.config.primaryBrandColor+";}40% {box-shadow: 0 2.5em 0 0 "+c.config.primaryBrandColor+";}}";
a.styleSheet?a.styleSheet.cssText=b:a.appendChild(document.createTextNode(b)),d("body").append(a),this.overlayElement.append(this.indicatorElement),d("body").append(this.overlayElement)},show:function(){this.installed||this.install(),this.installed=!0,this.overlayElement.show()},hide:function(){this.overlayElement.hide()}},c.plugins=c.plugins||{},c.plugins.customPlaceholders=function(a){function b(){d(this).val()==d(this).attr("placeholder")&&d(this).val("")}function c(){d(this).val()||d(this).val(d(this).attr("placeholder"))}a.val(a.attr("placeholder")),a.on("focus",b),a.on("blur",c)},c.cookie={prefix:"exitintel_",set:function(a,b,d){a=c.cookie.prefix+a;var e="";if(d){var f=new Date;f.setTime(f.getTime()+24*d*60*60*1e3),e="; expires="+f.toGMTString()}var g=window.location.host.match(/([^.]+\.[^\.]+)$/);g&&(g=g[0]),g||(g=window.location.host),document.cookie=a+"="+b+e+";path=/;"},get:function(a){a=c.cookie.prefix+a;for(var b=a+"=",d=document.cookie.split(";"),e=0;e<d.length;e++){for(var f=d[e];" "==f.charAt(0);)f=f.substring(1,f.length);if(0===f.indexOf(b))return f.substring(b.length,f.length)}return null},unset:function(a){a=c.cookie.prefix+a,c.cookie.set(a,"",-10)},getJSON:function(a,b){var d,e=c.cookie.get(a);try{d=JSON.parse(e)}catch(f){d=null}return!d&&b?b:d},setJSON:function(a,b,d){var e=JSON.stringify(b);c.cookie.set(a,e,d)}},c.visitor={identity:{_initialized:!1,id:null,campaigns:{seen:[],converted:[],disabled:[],visited:[]}},session:{id:null,originalReferrer:null,landingPage:null,isFirstVisit:!1},init:function(){if("undefined"!=typeof eiSession&&eiSession.hasOwnProperty("identity")&&eiSession.hasOwnProperty("session"))return void this.initWithSession();var a=c.cookie.get("vid");a||(a=c.util.getUniqueId(),c.cookie.set("vid",a,c.config.cookieExpirationDays)),this.identity.id=a,this.session.id=c.cookie.get("sid"),this.session.id||(this.session.id=c.util.getUniqueId(),this.session.isFirstVisit=!0,c.cookie.set("sid",this.session.id)),this.session.originalReferrer=c.cookie.get("ref"),this.session.originalReferrer||(this.session.originalReferrer=document.referrer,c.cookie.set("ref",this.session.originalReferrer)),this.session.landingPage=c.cookie.get("lp"),this.session.landingPage||(this.session.landingPage=document.URL,c.cookie.set("lp",this.session.landingPage)),this.loadCampaignInfo(),this.filterExpiredCampaignInfo(),this.saveCampaignInfo(),this.identity._initialized=!0},initWithSession:function(){this.identity=eiSession.identity,this.session=eiSession.session,this.saveCampaignInfo()},getAssignedConfiguration:function(){var a=c.cookie.get("cfid");return a?a:null},assignConfiguration:function(a){c.cookie.set("cfid",a,c.config.cookieExpirationDays)},chooseConfiguration:function(a){for(var b=a.map(function(a){return parseInt(a.bias,10)}),d=Math.round(100*Math.random()),e=0,f=0;f<b.length;f++)if(e+=b[f],e>=d){var g=a[f];return c.visitor.assignConfiguration(g.id),g.id}return"default"},getIdentity:function(){return this.identity._initialized||this.init(),this.identity},loadCampaignInfo:function(){var a={seen:"cs",converted:"cc",disabled:"cd",visited:"cv"};for(var b in a)if("function"!=typeof a[b]){var d=c.cookie.getJSON(a[b]);"string"==typeof d&&d.length>1&&(d=null,c.util.warn("Corrupted: "+b)),d||(d=[]),this.identity.campaigns[b]=d}},saveCampaignInfo:function(){var a={seen:"cs",converted:"cc",disabled:"cd",visited:"cv"};for(var b in a)"function"!=typeof a[b]&&c.cookie.setJSON(a[b],this.identity.campaigns[b],c.config.cookieExpirationDays)},filterExpiredCampaignInfo:function(){for(var a in this.identity.campaigns)if("function"!=typeof this.identity.campaigns[a]){for(var b=this.identity.campaigns[a],c=[],d=0;d<b.length;d++){var e=b[d];(!e.expires||e.expires>Math.floor((new Date).getTime()/1e3))&&c.push(e)}this.identity.campaigns[a]=c}},getViewportSize:function(){var a=Math.max(document.documentElement.clientWidth,window.innerWidth||0),b="xs";a>=768&&992>a?b="sm":a>=992&&1200>a?b="md":a>=1200&&(b="lg");var c={width:a,height:Math.max(document.documentElement.clientHeight,window.innerHeight||0)};return c["class"]=b,c},_setCampaignStatus:function(a,b,c,d){c||(c=null),d||(d={});var e=!1;this.identity.campaigns[a]||(this.identity.campaigns[a]=[]);for(var f=0;f<this.identity.campaigns[a].length;f++){var g=this.identity.campaigns[a][f];g.id==b&&(g.expires=c,g.timestamp=Math.floor((new Date).getTime()/1e3),g.params=d,g.count++,e=!0)}if(!e){var h={id:b,expires:c,timestamp:Math.floor((new Date).getTime()/1e3),params:d,count:1};this.identity.campaigns[a].push(h)}this.saveCampaignInfo()},_unsetCampaignStatus:function(a,b){for(var c=this.identity.campaigns[a],d=[],e=0;e<c.length;e++)c[e].id!=b&&d.push(c[e]);this.identity.campaigns[c]=d,this.saveCampaignInfo()},setSeenCampaign:function(a,b){var d=c.campaign.get(a),e=null;d.seenExpiration&&(e=c.util.getDayOffset(d.seenExpiration)),this._setCampaignStatus("seen",a,e,b)},setConvertedCampaign:function(a,b){var d=c.campaign.get(a),e=null;d.convertedExpiration&&(e=c.util.getDayOffset(d.convertedExpiration)),this._setCampaignStatus("converted",a,e,b)},setDisabledCampaign:function(a,b){var d=c.campaign.get(a),e=null;d.disabledExpiration&&(e=c.util.getDayOffset(d.disabledExpiration)),this._setCampaignStatus("disabled",a,e,b)},unsetSeenCampaign:function(a){this._unsetCampaignStatus("seen",a)},unsetConvertedCampaign:function(a){this._unsetCampaignStatus("converted",a)},unsetDisabledCampaign:function(a){this._unsetCampaignStatus("disabled",a)},hasSeenCampaign:function(a){for(var b=c.visitor.identity.campaigns.seen,d=0;d<b.length;d++)if(b[d].id==a)return!0;return!1},hasSeenCampaigns:function(a){for(var b=0;b<a.length;b++){var d=a[b],e=c.visitor.getSeenCampaign(d.campaignId);if(!e)return!1;if(!c.util.campaignCookieWithinTimeOffset(e,d.offsetFrom,d.offsetTo))return!1}return!0},getSeenCampaign:function(a){var b=c.visitor.identity.campaigns.seen;if(!b)return!1;for(var d=0;d<b.length;d++)if(b[d].id==a)return b[d];return!1},hasConvertedCampaign:function(a){var b=c.visitor.identity.campaigns.converted;if(!b)return!1;for(var d=0;d<b.length;d++)if(b[d].id==a)return!0;return!1},hasConvertedCampaigns:function(a){for(var b=0;b<a.length;b++){var d=a[b],e=c.visitor.getConvertedCampaign(d.campaignId);if(!e)return!1;if(!c.util.campaignCookieWithinTimeOffset(e,d.offsetFrom,d.offsetTo))return!1}return!0},getConvertedCampaign:function(a){var b=c.visitor.identity.campaigns.converted;if(!b)return!1;for(var d=0;d<b.length;d++)if(b[d].id==a)return b[d];return!1},getDisabledCampaign:function(a){var b=c.visitor.identity.campaigns.disabled;if(!b)return!1;for(var d=0;d<b.length;d++)if(b[d].id==a)return b[d];return!1},hasVisitedCampaign:function(a){return c.visitor.identity.campaigns.visited.indexOf(a)>-1?!0:!1},setVisitedCampaign:function(a){-1==c.visitor.identity.campaigns.visited.indexOf(a)&&c.visitor.identity.campaigns.visited.push(a),this.saveCampaignInfo()}},c.campaign={available:[],active:[],dependencies:[],init:function(){this.loadFromUrl()},campaignsLoaded:function(){c.campaign.chooseAds(),c.campaign.chooseActive();for(var a=!1,b=0;b<c.campaign.active.length;b++){var d=c.campaign.active[b];if(d.selectedAd){var e={};d.displayLimitPerPage&&(e.displayLimitPerPage=d.displayLimitPerPage);var f=c.util.detectDevice.isMobile,g="desktop";if(f.phone?g="phone":f.tablet&&(g="tablet"),d.selectedAd.selectedVersion&&d.selectedAd.selectedVersion.trigger&&d.selectedAd.selectedVersion.trigger[g]&&"on-load"==d.selectedAd.selectedVersion.trigger[g].type){if(a)continue;a=!0}e.priority=d.priority,c.ad.install(d.selectedAd,e)}c.event.log("pageview",{campaignId:d.id,adId:d.selectedAd?d.selectedAd.id:null})}var h=null,i=null;c.campaign.active.length&&(h=c.campaign.active[0],c.campaign.active[0].selectedAd&&(i=c.campaign.active[0].selectedAd)),c.event.log("pageview")},loadFromUrl:function(){var a=c.visitor.getIdentity();c.config.prefetchedConfiguration?c.campaign.campaignsFileLoaded(c.config.prefetchedConfiguration):c.api.getCampaigns(c.config.clientId,a.id)},applyConfiguration:function(a){switch(a){case"control":c.campaign.available=[];break;case"default":break;default:var b=c.config.configurations.filter(function(b){return b.id==a?!0:!1});if(b&&1==b.length){var d=b[0].campaigns;c.campaign.available=c.campaign.available.filter(function(a){return d.indexOf(a._id)>-1?!0:!1})}}},campaignsFileLoaded:function(a){c.campaign.available=a.campaigns,c.config.whitelabel=a.whitelabel,c.config.primaryBrandColor=a.primaryBrandColor,c.config.configurations=a.configurations||[];var b="default";if(c.config.configurations.length?(b=c.visitor.getAssignedConfiguration(),b||(b=c.visitor.chooseConfiguration(c.config.configurations))):c.visitor.assignConfiguration("default"),c.campaign.applyConfiguration(b),a.onloadJS){-1==a.onloadJS.indexOf("deferred.resolve()")&&(a.onloadJS+=";deferred.resolve();"),-1==a.onloadJS.indexOf("return deferred.promise();")&&(a.onloadJS+=";return deferred.promise();");var d=new Function("deferred",a.onloadJS),e=new c.util.jQuery.Deferred;d(e),e.then(function(){c.campaign.campaignsLoaded()})}else c.campaign.campaignsLoaded()},chooseActive:function(){for(var a=0;a<c.campaign.available.length;a++)this.isEligible(c.campaign.available[a])?(c.util.log("Active campaign: "+c.campaign.available[a].id),this.active.push(c.campaign.available[a])):c.util.log("Not active campaign: "+c.campaign.available[a].title);this.active.length||c.util.log("No active campaigns.")},chooseAds:function(){for(var a=0;a<this.available.length;a++){var b=this.available[a];if(!b.selectedAd&&(c.util.log(b.id+" has "+b.enabled_ads.length+" enabled ads."),b.enabled_ads.length)){var d=c.visitor.getSeenCampaign(b.id),e=null;d.params&&d.params.adId&&(e=d.params.adId);var f=null;if(e)for(var g=0;g<b.enabled_ads.length;g++)b.enabled_ads[g]._id==e&&(f=b.enabled_ads[g],f.number=g);if(!f){var h=Math.floor(Math.random()*b.enabled_ads.length);f=b.enabled_ads[h],f.number=h}this.chooseVersion(f),f.selectedVersion&&(this.available[a].selectedAd=f)}}},chooseVersion:function(a){if(!a.selectedVersion)for(var b=c.visitor.getViewportSize(),d=0,e=0;e<a.versions.length;e++){var f=a.versions[e];if(f.template&&"true"==f.ready){var g=parseInt(f.template.width,10),h=parseInt(f.template.height,10);if("Persistent"==f.template.type&&(g=parseInt(f.template.persistentInnerCanvasPosition.width,10),h=parseInt(f.template.persistentInnerCanvasPosition.height,10)),c.util.log("Inspecting ad: ",e),"manual"==f.mediaTargetMode){if(-1==f.mediaTargets.indexOf(b["class"]))continue}else if(g>b.width+20)continue;var i=g*h;if(!(d>i)){d=i,a.selectedVersion=f;var j=c.ad.getVersionDependencies(f);if(j.length)for(var k=0;k<j.length;k++){var l=j[k];c.campaign.selectAd(l.campaignId,l.adId)}}}}},selectAd:function(a,b){for(var d=0;d<this.available.length;d++){var e=this.available[d];if(e.id==a)for(var f=0;f<e.enabled_ads.length;f++){var g=e.enabled_ads[f];g.id==b&&(c.util.log("force selecting (dependency): ",g.title),this.chooseVersion(g),g.selectedVersion&&(this.available[d].selectedAd=g))}}},isEligible:function(a){if(a.displayLimit){var b=c.visitor.getSeenCampaign(a.id);if(b&&b.count>=a.displayLimit)return!1}if(a.maximumConversions){var d=c.visitor.getConvertedCampaign(a.id);if(d&&d.count>=a.maximumConversions)return!1}var e=c.visitor.getDisabledCampaign(a.id);if(e)return!1;for(var f=0;f<a.rules.length;f++){var g=a.rules[f];if("disable"==g.mode&&this.testRule(g))return c.visitor.setDisabledCampaign(a.id),!1;if("show"==g.mode&&!this.testRule(g))return!1;if("hide"==g.mode&&this.testRule(g))return!1}return!0},testRule:function(a){switch(a.filter){case"url":return this.testURLRule("pageURL",a);case"referer-url":return this.testURLRule("referrerURL",a);case"landing-page-url":return this.testURLRule("landingPageURL",a);case"prerequisite-campaign":return c.visitor.hasSeenCampaigns(a.prerequisiteCampaign);case"prerequisite-negative-campaign":return!c.visitor.hasSeenCampaigns(a.prerequisiteCampaign);case"prerequisite-converted-campaign":return c.visitor.hasConvertedCampaigns(a.prerequisiteCampaign);case"prerequisite-negative-converted-campaign":return!c.visitor.hasConvertedCampaigns(a.prerequisiteCampaign)}},testURLRule:function(a,b){var d=!1;switch(b.filterType){case"not-contains":d=!0;case"contains":if(c.util[a+"Contains"](b.value))return!d;break;case"not-exact-match":d=!0;case"exact-match":if(c.util[a+"Is"](b.value))return!d}return d},get:function(a){for(var b=0;b<c.campaign.available.length;b++)if(c.campaign.available[b].id==a)return c.campaign.available[b];return null}},c.ecommerce={handleEvent:function(a){c.event.log(a[1],{data:a[2]})}},c.trigger={installedTriggers:{},postponedTriggers:[],install:function(a,b,d){if("undefined"==typeof c.triggerTypes[a])return void c.util.log("Trigger type '"+a+"' is not supported.");var e=c.triggerTypes[a].install,f=c.util.getUniqueId();if("true"==d.postpone){var g=parseInt(d.postponeBy,10);c.util.log("Postponing trigger installation for "+g+" seconds.");var h=setTimeout(function(){e(f,b,d)},1e3*g);c.trigger.postponedTriggers.push(h)}else e(f,b,d);return c.trigger.installedTriggers[f]={type:a},f},uninstall:function(a){if("undefined"==typeof c.trigger.installedTriggers[a])return void c.util.log("Unable to uninstall trigger: "+a+". Not found.");if(null===c.trigger.installedTriggers[a])return void c.util.log("Trigger: "+a+" is already uninstalled");var b=c.trigger.installedTriggers[a],d=c.triggerTypes[b.type].uninstall;d(a)&&(c.trigger.installedTriggers[a]=null)},uninstallAll:function(){for(var a in this.installedTriggers)"function"!=typeof this.installedTriggers[a]&&this.uninstall(a);for(var b=0;b<this.postponedTriggers.length;b++)clearTimeout(this.postponedTriggers[b])}},c.triggerTypes={onLoad:{install:function(a,b,c){var e=1e3*c.delay||0;d(document).ready(function(){setTimeout(b,e)})},uninstall:function(){return!0}},onExit:{install:function(a,b,c){var e="mouseleave."+a+".exitintel",f=1e3*c.delay||0;return d("html").on(e,function(a){var c=a.pageY-d(window).scrollTop();2>=c&&(f?setTimeout(b,f):b())}),d("html").on("keydown."+a+".exitintel",function(a){a.metaKey&&76===a.keyCode&&(f?setTimeout(b,f):b())}),!0},uninstall:function(a){var b="mouseleave."+a+".exitintel";return d("html").off(b),b="keydown."+a+".exitintel",d("html").off(b),!0}},onScrollTimeout:{install:function(a,b,c){var e=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(","),f=1e3*c.delay||0,g=null;return d(window).on(e,function(){clearTimeout(g),g=setTimeout(function(){b()},f)}),!0},uninstall:function(a){var b=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(",");d(window).off(b)}},onScrolledToBottom:{install:function(a,b,c){var e=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(","),f=1e3*c.delay||0;d(window).on(e,function(){var a=d(document).height(),c=d(window).height()+d(window).scrollTop();(a-c)/a===0&&setTimeout(function(){b()},f)})},uninstall:function(a){var b=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(",");d(window).off(b)}},onScrolledToElement:{install:function(a,b,c){var e=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(","),f=1e3*c.delay||0,g=d(c.selector),h=null;switch(c.targetMode){case"reached-top":h=g.position().top;break;case"reached-bottom":h=g.position().top+g.height()}g.length&&d(window).on(e,function(){var a=d(window).height()+d(window).scrollTop();0>=(h-a)/h&&setTimeout(function(){b()},f)})},uninstall:function(a){var b=["scroll."+a+".exitintel","touchmove."+a+".exitintel"].join(",");d(window).off(b)}}},c.event={logServiceURL:"//app.exitintel.com/log/ei.gif?",queueProcessingTimeout:null,queue:[],log:function(a,b){if(b&&b.onDone){var c=this.serializeEvent({type:a,args:b});return void this.sendEvents([c],b.onDone)}this.queue.push({type:a,args:b}),clearTimeout(this.queueProcessingTimeout),this.queueProcessingTimeout=setTimeout(this.processQueue,1e3)},processQueue:function(){if(c.event.queue.length){for(var a=[],b=0;b<c.event.queue.length;b++){var d=c.event.queue[b];a.push(c.event.serializeEvent(d))}c.event.sendEvents(a),c.event.queue=[]}},serializeEvent:function(a){var b={};switch(a.args&&(a.args.campaignId&&(b.cId=a.args.campaignId,b.stId=a.args.campaignId+"-st"),a.args.adId&&(b.adId=a.args.adId),a.args.data&&(b.data=JSON.stringify(a.args.data))),a.type){case"pageview":b.et="p",!c.visitor.session.isFirstVisit||a.args&&a.args.campaignId?a.args&&a.args.campaignId&&!c.visitor.hasVisitedCampaign(a.args.campaignId)&&(b.et+=",v"):(b.et+=",v",c.visitor.session.isFirstVisit=!1),a.args&&a.args.campaignId&&!c.visitor.hasVisitedCampaign(a.args.campaignId)&&c.visitor.setVisitedCampaign(a.args.campaignId);break;case"ad-impression":b.et="i";break;case"collect-data":b.et="c";break;case"trackItemView":b.et="ev";break;case"trackCartUpdate":b.et="ec";break;case"trackAddItem":b.et="ea";break;case"trackOrder":b.et="eo"}return b},sendEvents:function(a,b){("undefined"==typeof exitintelBetaStats||exitintelBetaStats)&&c.betastats.sendEvents(a);for(var e=["aId="+encodeURIComponent(c.config.clientId),"vId="+encodeURIComponent(c.visitor.identity.id),"sId="+encodeURIComponent(c.visitor.session.id),"ref="+encodeURIComponent(c.visitor.session.originalReferrer)],f=0;f<a.length;f++){var g=a[f];for(var h in g)"function"!=typeof g[h]&&e.push("e["+f+"]["+h+"]="+encodeURIComponent(g[h]))}var i=new Image;b&&(d(i).on("load",function(){b(!0)}),i.onerror=function(){b(!0)},i.onabort=function(){b(!0)}),i.src=c.event.logServiceURL+e.join("&")+"&_t="+(new Date).valueOf()}},c.betastats={sendEvents:function(a){for(var b=["aId="+encodeURIComponent(c.config.clientId),"vId="+encodeURIComponent(c.visitor.identity.id),"sId="+encodeURIComponent(c.visitor.session.id),"ref="+encodeURIComponent(c.visitor.session.originalReferrer),"cId="+encodeURIComponent(c.visitor.getAssignedConfiguration())],d=0;d<a.length;d++){var e=a[d];for(var f in e)"function"!=typeof e[f]&&b.push("et"==f?"e["+d+"][t]="+encodeURIComponent(e[f]):"e["+d+"][d]["+f+"]="+encodeURIComponent(e[f]))}var g=new Image;g.src="https://betastats.exitintel.com/?"+b.join("&")+"&_t="+(new Date).valueOf()}},c.shopify={cartSessionAppend:function(a){var b=document.getElementById(a);if(b){var d={identity:c.visitor.identity,session:c.visitor.session},e=document.createElement("span");e.innerHTML='<input type="hidden" name="attributes[ei-session]" value="'+encodeURIComponent(JSON.stringify(d))+'"/>',b.appendChild(e)}}},Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),c.commands={timer:null,startCheckLoop:function(){c.commands.timer=setInterval(function(){c.commands.checkQueue()},1e3)},stopCheckLoop:function(){clearTimeout(c.commands.timer)},checkQueue:function(){if("undefined"!=typeof window._exiq){if(0===window._exiq.length)return;for(var a=0;a<window._exiq.length;a++)if(Array.isArray(window._exiq[a])&&window._exiq[a].length>0){var b=window._exiq[a],d=b[0];switch(d){case"_setVar":c.visitor.session.vars=c.visitor.session.vars||{},c.visitor.session.vars[b[1]]=b[2];break;case"ecommerce":c.ecommerce.handleEvent(window._exiq[a])}}}}},c.profiler={connected:!1,socket:null,performance:{},connect:function(){window.performance&&window.performance.timing&&(c.profiler.performance=window.performance.timing,c.util.loadJS(c.config.profilerLibURL,function(){c.profiler.socket=io(c.config.profilerURL),c.profiler.connected=!0,c.profiler.init()}))},init:function(){var a=c.profiler.performance;c.profiler.socket.emit("meta",{"user-agent":navigator.userAgent,url:window.location.href,"visitor-id":c.visitor.identity.id,"session-id":c.visitor.session.id}),c.profiler.sendValue("window-loaded",a.loadEventEnd-a.connectStart),c.profiler.sendValue("dom-ready",a.domComplete-a.connectStart),c.profiler.send("connected")},sendValue:function(a,b){c.profiler.connected&&(console.warn("send: "+a),c.profiler.socket.emit("time",{name:a,value:b}))},send:function(a){var b=c.profiler.performance;c.profiler.sendValue(a,(new Date).valueOf()-b.connectStart)}},a.exitintelConfig&&a.exitintelConfig.clientId&&(c.config.clientId=a.exitintelConfig.clientId),c.config.clientId&&d(document).ready(function(){window.exitintel&&window.exitintel.inited===!0||(!function(){if("undefined"!=typeof Prototype&&parseFloat(Prototype.Version.substr(0,3))<1.7&&"undefined"!=typeof Array.prototype.toJSON){var a=JSON.stringify;JSON.stringify=function(b){var c=Array.prototype.toJSON;delete Array.prototype.toJSON;var d=a(b);return Array.prototype.toJSON=c,d}}}(),c.inited=!0,c.commands.checkQueue(),c.campaign.init(),c.config.profilerEnabled&&c.profiler.connect())})}),a.exitintel=c}(this);
